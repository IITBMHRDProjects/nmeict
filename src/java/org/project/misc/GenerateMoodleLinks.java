/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package org.project.misc;

import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.util.ArrayList;
import java.util.regex.Pattern;
import org.project.bean.Participant;
import org.project.process.UtilityProcess;
import org.project.utilities.DBConnection;
import static org.project.utilities.DBConnection.con;

/**
 *
 * @author abinaya
 */
public class GenerateMoodleLinks {

    PreparedStatement pstmt;
    ResultSet res;

    public static void main(String args[]) {
//for enrolling to moodle
//        String moodleLink = "path/moodle/moodle-enrolment.php?id=#pid#&ide=#email#&type=main";
// for unenrollment from moodle
        String moodleLink = "path/moodle/moodle-unenrolment.php?id=#pid#&ide=#email#&type=main";

// Set the participants
        //String participants = "116944,118081,128830,132889,131136,132096,120837,129110,129125,129137,129161,129170,129309,129319,129527,131029,130832,133770,117294,115305,117283,118567,115705,133820,132227";
//        String participants = "124557,132221,132959";
// cancelled CN        
        String participants = "118180,120595,123579,124948,124973,125345,125380,127885,133317,134104,119521,119735,120404,122393,122480,122974,122975,123270,123292,123347,126062,126144,126251,126302,126755,126779,127815,131845,131992,132540,132659,133479,134041,134177,129940,129944,134226,134230,134232,115766,115737,115732,116335,115542,115540,118585,118879,119674,119744,119758,121544,122614,128888,128891,129198,131695,131870,133034,129654,129673,129693,129697,133094,133180,133234,133309,133412,133796,133887,120747,120857,121094,122006,122478,131952,132745,133186,133236,133272,133315,133370,133605,133609,134210,134211,125862,130156,130246,130409,122321,122833,122837,122884,122901,124964,119132,127889,127893,132699,118297,119190,119390,128347,129975,129976,129977,124613,128420,132708,133318,133694,133864,133865,133905,134125,134137,134144,134148,134248,134249,118833,118857,119276,119458,130711,133086,133224,133927,130652,131216,131526,132182,132575,133825,133842,123391,131145,131154,131173,131174,132488,117230,117240,117265,117250,117268,117270,117274,117261,121182,121543,123782,123813,125271,127682,128682,128983,129157,129184,130484,134223,117413,117428,117452,117694,117793,117806,117812,118229,118262,118327,118452,119239,129889,130651,131886,128232,132692,132836,132887,132902,133188,116230,117101,118340,123743,123774,126338,131805,131838,131912,132326,132361,132512,132553,133860,134262,130636,130762,130766,131830,131835,132113,132151,132159,132164,132173,132185,132198,132207,132257,132265,132283,132289,132303,132332,132598,118387,125048,127311,128011,128046,128555,128562,128563,130273,130887,132807,133677,133691,133958,120796,120945,122566,128456,129484,129501,129738,131650,131671,132339,132360,132681,132913,132966,133383,133741,134063,134068,134073,116605,116621,116776,116777,117929,118254,133647,123151,128949,128964,128966,128982,128987,128992,129001,116973,117009,116955,116959,117477,116478,116957,116419,116184,118399,116182,118480,116848,117144,118513,118514,118516,117147,118538,118541,118602,118884,118928,118945,119143,119442,121638,121741,122285,128672,128680,129069,129998,129667,129812,123200,123553,124097,125456,119571,119600,120233,121223,124377,134083,132121,132285,132296,132309,132358,132385,132501,132737,132787,132829,132882,133031,133496,126811,126829,126858,116961,123652,124666,124671,130914,120366,120370,120378,120382,122817,128892,132068,132755,132792,132811,134244,124668,116837,116841,130701,133115,133307,114836,120848,124218,129303,129331,130892,133554,122129,122174,122867,123222,128751,129243,129252,129327,129345,129366,129411,129448,128245,128253,128262,128267,129869,130201,130224,130235,130466,130184,130277,130805,129083,129237,129244,129250,129270,129273,132333,132423,132455,132470,132485,121486,124390,132402,116577,116586,116611,116608,116596,117939,118049,116475,118627,118790,119646,119637,119643,121138,121441,121444,121818,122761,122781,123294,128320,130611,132874,133393,134016,134153,118774,119699,132702,133841,117492,124457,129497,129509,129523,129533,134033,134037,129219,131465,130844,134253,116792,118557,119783,124091,124124,128120,130342,130347,130351,130359,130384,130392,130398,130406,130419,130424,130430,130435,130462,133674,133683,133846,133849,120970,126934,126940,128596,128722,129860,129864,129876,131277,132012,132014,132016,133869,133876,134195,134199,117005,116031,117306,119410,119413,119416,119421,132450,134112,117028,117034,130352,130442,131979,131981,132231,132278,132300,132350,132444,132465,132886,132898,132927,132939,132962,133018,133122,133147,134167,134170,134171,134173,121542,118460,118000,118356,123501,125279,125287,125294,125295,126011,133641,116273,117015,119406,116874,118886,119693,120658,121140,121145,121578,121877,122116,122990,123097,124532,124898,128745,129247,129351,130101,130562,130571,130918,131317,131374,131426,131659,131688,131736,131741,131765,131776,131834,131888,131893,133110,115529,117598,118269,118272,122325,129633,131370,134189,134194,116375,115464,118920,130407,119928,119933,119936,123191,123485,123610,124617,124694,124716,124790,124882,125255,130669,130676,133382,133972,133643,133730,133872,123974,132591,133349,133591,133606,133620,134095,134122,132631,132652,131297,132742,133545,124352,124375,134082,117350,117355,118493,118498,119874,121270,121291,121305,121315,125005,125037,126691,129583,129846,130508,132897,124197,124230,129109,129792,131109,131118,133316,133338,130214,130261,130306,130427,130511,130730,131399,131923,131949,131956,131963,132452,132497,132601,132638,132671,132683,132712,132735,132756,132812,132834,132849,132862,133028,133044,133071,133194,133214,133223,133268,133324,133352,133400,133868,134002,120230,123949,124153,128845,128862,132910,133247,128727,128923,128934,129819,130240,132058,133896,129557,131106,133615,116797,116887,116909,116928,117369,117676,118278,129418,129602,131024,130262,131372,131379,131408,131418,132994,133448,133505,133552,133718,131822,131874,131906,131918,131972,131978,131982,132335,132721,132803,132842,132859,132926,133037,133212,133279,133502,133854,133874,134231,119986,120002,120013,118808,121190,121248,121296,125903,128633,129133,133999,117425,117560,118526,129426,129616,130047,130048,130116,130122,130299,130302,130317,132324,132330,132337,132960,130829,131415,132379,132389,132447,133379,128077,132064,132655,124428,124597,131571,131629,131663,131719,131740,131761,131777,131780,131792,131793,131802,131803,131811,131813,131820,131824,131826,131832,131836,131840,131846,131849,131851,131867,131872,121676,122261,128088,129708,133283,133427,133446,134181,134202,117225,117256,117332,119315,120099,120239,121201,121231,122799,123990,124496,124529,124589,124665,124675,125176,125223,125738,128413,129190,129202,132957,133257,133299,133348,133781,134094,117647,119372,133551,116431,116438,116504,119835,122031,122536,124838,129600,132484,133182,133220,133852,133937,130091,133003,133787,125692,129632,133096,133109,133125,133527,133594,133607,133617,133765,128839,128844,128850,128854,129100,129108,129150,129180,129238,129246,129561,134193,132050,120048,127762,128017,129868,129875,130172,133074,133101,133130,132038,132510,132619,132632,132675,132796,132880,118512,119036,119038,120355,120397,120419,127161,127586,128948,128952,129971,131466,133831,130119,130680,130697,132149,122518,122539,122546,128866,130528,131626,131728,133813,129368,129412,129723,130572,118664,126394,129781,129991,129992,130010,130025,130581,130604,130605,130609,130642,131753,134116,134161,134164,120375,124430,129061,129352,129582,132261,132464,132626,132672,132847,133281,133297,133458,133951,122624,132572,132854,130206,130222,131446,131504,131547,133300,120015,128107,129071,129072,129432,129436,127114,127202,127880,134220,134243,131424,131570,131611,132063,132440,132982,132985,133960,122411,122630,122667,122709,122977,128565,129045,129064,129176,132481,133603,117607,117894,119065,122681,122686,122696,127192,129598,133688,133693,133696,133703,133707,133715,133804,133812,133815,133816,134198,134214,125173,134091,134133,130614,116663,129571,129597,129811,132907,133640,134057,134065,134255,117886,116667,116676,132843,132857,132871,116678,128223,128224,128228,128752,129390,129402,129407,133840,120414,121229,121759,121809,121872,122099,122127,122279,122910,125377,128506,130446,133708,133717,125824,125842,128496,133658,132139,132429,132457,132507,132908,132961,133102,128951,128955,128957,129006,129018,129025,129029,129036,120927,125883,125909,117348,118782,118852,125925,125991,126439,126466,127737,128214,116466,128114,133495,116885,116890,116910,122693,123829,128270,128989,132731,132772,133457,133726,133782,133824,118642,126303,126851,131127,115751,118362,115747,115744,119393,120610,120923,121088,131044,132523,116508,131279,131361,131898,132137,133762,116073,116076,116078,116082,116759,116765,117227,116092,116094,117272,128538,128541,130580,130620,130626,130640,131071,131198,132963,133195,133266,133333,133929,133934,133936,133941,129997,118425,118428,118543,119247,119274,119278,119499,120308,120309,127537,128625,132066,132094,132099,132105,132230,133689,133697,133723,116854,116852,116826,114851,116983,117062,117089,116763,117221,120872,121130,124233,128772,132599,132844,134115,115635,122497,133021,133129,133590,134032,134158,128924,128972,131152,122044,122077,122092,129611,130064,130658,130943,131707,131717,132039,132518,132528,132549,132564,133134,133720,133735,133743,134166,120216,117863,118570,118576,118591,130293,129627,129649,129656,129668,130054,130056,130063,132380,132387,132396,132424,132434,132442,132799,132831,132864,133364,133837,118333,116872,120200,120203,120210,120235,121280,121446,121468,121469,121585,121882,121887,121984,122241,129473,117896,116697,118450,118712,121347,128092,128875,130086,130932,132006,132308,132620,132621,133785,117134,126682,131485,131584,131622,131716,131850,132157,133544,133562,133808,133814,133817,133819,133821,131528,132678,132716,119192,119193,119194,119196,129498,129789,129802,129806,129830,132517,132823,133367,133386,133391,133407,129060,129082,130847,130961,131245,131675,132544,133747,130962,133020,133907,133969,133978,133983,129106,130386,131348,133027,133064,133072,133140,133175,133248,133918,133982,133990,121154,121161,126582,131052,131066,131072,131096,131101,131169,131958,132688,133065,133908,133914,133916,133924,134013,134017,134020,134021,134025,134044,134045,134099,134101,134107,122335,125362,131073,132506,132174,132181,133721,133736,130372,134301,134300,131505,131512,131539,131585,131592,131640,131655,131713,133919,122205,123198,123261,123349,127925,131308,132143,132155,128357,128389,128816,128818,133517,133662,133671,120534,130060,130510,131002,131065,131213,131292,132010,116112,116126,114960,115517,115641,115505,115764,128241,128642,128644,128893,131518,133119,133137,128794,129587,129619,129882,129916,129981,131815,132215,132228,132478,132559,132863,133138,133150,133154,133189,128661,130098,130866,130889,132406,132730,132868,133087,133126,133303,133851,130992,131095,133311,129659,131977,132106,132234,116379,117990,119338,119349,119912,119922,119931,119956,120003,116796,116794,120881,121531,121532,125438,132104,133803,134280,134288,121187,122408,123824,124042,124299,124446,132641,133979,121053,124960,125451,130958,132435,132758,117216,117541,117978,118094,118166,120576,121333,122272,123632,123861,126208,126615,127392,127408,127444,127448,127927,127971,127973,128005,128178,128411,128419,129099,129155,129172,129216,129225,129262,129286,129290,129302,129304,129316,129478,129508,129528,129537,129681,129748,130036,130331,130408,130518,130540,130702,130750,130760,130802,130864,131055,131185,131218,131364,131386,131391,131480,131508,131827,131859,131959,132107,132161,132203,132268,132280,132315,132319,132349,132362,132378,132410,132561,132627,132656,132743,133047,133135,133197,133222,133252,133472,133508,133512,133514,133520,133526,133535,133548,133560,133565,133571,133597,133622,133679,133988,133989,134085,134271,134272,127402,132200,124262,129957,129968,129984,131368,133624,133933,133935,133678,133756,133760,133767,133771,133775,133776,133778,130132,130141,130539,130597,130705,131343,131673,131705,131771,132610,134118,134174,120940,120968,120992,121003,121018,121019,121046,121095,121099,121108,121116,121122,121133,121146,121261,122271,122796,123687,123713,123753,123822,123840,123919,123944,124469,124521,124535,125386,127569,127579,128301,129856,129877,129883,129888,129891,129895,129941,130853,131034,131138,131183,131476,131499,132213,132258,133848,129231,129852,130026,130757,131283,131709,132298,132320,132431,129070,133286,133456,130490,130502,130533,133355,133366,133381,133392,133404,133416,133423,133436,133437,133454,119202,121501,125418,129169,130298,130453,130488,130765,130876,131013,131125,131307,131331,132049,132054,133827,115471,115476,115481,115488,115485,115474,115483,115478,115462,115554,115556,116285,115458,119250,116119,119592,122047,125900,128869,128874,128937,129288,129297,133619,133684,134233,118859,118914,123269,123667,127450,127497,127535,130094,130377,130394,131800,129004,129014,129020,129479,121600,121720,121839,129030,129980,130015,130016,130017,130018,130020,130464,132295,116948,131891,123505,131635,133347,134142,132604,133173,128548,130624,129462,117775,118696,119111,130641,130645,130647,131074,131239,131248,131269,131273,131274,131276,131303,131457,131809,132092,132338,132629,132808,133033,134023,134040,134071,134208,134213,122617,126495,129684,129686,131237,132400,132899,133168,133441,121462,129603,129696,129896,129918,130142,130287,130349,130964,130983,131010,131050,132286,133450,130615,130623,130635,131376,131479,131507,129401,133451,134126,130188,131156,133167,133205,115827,118256,129785,132314,132964,131810,119402,125671";

        GenerateMoodleLinks proc = new GenerateMoodleLinks();

        ArrayList<Participant> list = new ArrayList<Participant>();
        list = proc.getParticipantListForMoodle(participants);

        for (int i = 0; i < list.size(); i++) {
            String url = moodleLink;

            url = Pattern.compile("#pid#").matcher(url).replaceAll(Integer.toString(list.get(i).getParticipantid()));

            url = Pattern.compile("#email#").matcher(url).replaceAll(list.get(i).getName());

            System.out.println(url);
        }
    }

    public ArrayList<Participant> getParticipantListForMoodle(String participants) {
        ArrayList<Participant> list = new ArrayList<Participant>();
        try {
            if (con == null || con.isClosed()) {
                con = DBConnection.getDBConnection();
            }
            if (con != null) {
                pstmt = con.prepareStatement("select p.participantid, c.email, p.status from participant p, context c where p.personid=c.idcontext and p.participantid IN ( " + participants + " )");
//                pstmt.setString(1, participants);
                ResultSet res = pstmt.executeQuery();
                Participant participant = null;
                while (res.next()) {
                    participant = new Participant();
                    participant.setParticipantid(res.getInt("participantid"));
                    // set email in name
                    participant.setName(res.getString("email"));
                    participant.setStatus(res.getString("status"));
                    // add the participant to list
                    list.add(participant);
                }
            }
        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            DBConnection.closeResultSet(res);
            DBConnection.closePStatement(pstmt);
            DBConnection.closeDBConnection(con);
        }
        return list;
    }

}
